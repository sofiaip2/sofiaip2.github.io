<!DOCTYPE html>
<html>
  <head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
      .bar {
        fill: steelblue;
      }
    </style>
  </head>
  <body>
    <h1>Investigating Correlations Between Music and Mental Health</h1>
    <p>Sofia Perry, UIUC CS 416 SU23</p>
    <div id="selectMe"></div>
    <div id="chartContainer"></div>
    <div id="my_dataviz"></div>
    <svg width = "600" height="500"></svg>
    <script>
        var margin = {top: 100, right: 100, bottom: 100, left: 100}, width = 900-margin.left-margin.right, height=500-margin.top-margin.bottom;
        var svg = d3.select("#my_dataviz").append("svg").attr("width", width + margin.left + margin.right).attr("height", height+margin.top+margin.bottom).append("g").attr("transform", "translate("+margin.left+","+margin+top+")");            

        var allData = d3.csv("scripts/mxmh_survey_results.csv");
        allData.then(function (allData) {
          myChart(allData);
          
          const mySelection = document.getElementById("selectMe");
          d3.select(mySelection).append("span").append("p").attr("class","label").text("How should these bars be sorted?").style("front-weight","bold").style("color","red").style("font-size","25px");
          const selectItems = ["All Genres", "Classical", "Country", "EDM", "Folk", "Gospel", "Hip Hop", "Jazz", "K pop", "Latin", "Lofi", "Metal", "Pop", "R&B", "Rap", "Rock", "Video Game Music"];
          d3.select(mySelection).append("span").append("select").attr("id","selection").attr("name", "tasks").selectAll("option").data(selectItems).enter().append("option").attr("value",d=>d).text(d=>d);
          //document.addEventListener("DOMContentLoaded", myChart());
          d3.select("#selection").on("change", function() {
            const selectedOption = d3.select(this).node().value;
            if (selectedOption == "Classical") {
              var filteredData = allData.filter(function(d)
                                             {
                                               if(d["FrequencyClassical"] == "Very frequently")
                                               {
                                                 return d
                                               }
                                             })
              myChart(filteredData)
            } else if (selectedOption == "Country") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyCountry"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "EDM") {
              var filteredData =allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyEDM"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Folk") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyFolk"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Gospel") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyGospel"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Hip Hop") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyHipHop"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Jazz") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyJazz"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "K pop") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyKpop"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Latin") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyLatin"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Lofi") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyLofi"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Metal") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyMetal"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Pop") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyPop"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "R&B") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyR&B"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Rap") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyRap"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Rock") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyRock"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "Video Game Music") {
              var filteredData = allData.filter(function(d)
                                                 {
                                                   if(d["FrequencyVideoGameMusic"] == "Very frequently")
                                                   {
                                                     return d
                                                   }
                                                 })
              myChart(filteredData)
            } else if (selectedOption == "All Genres") {               
              myChart(allData)
            }
          }); 
          
          //data.sort(function(b,a) { return a.Age - b.Age });
          //myChart();
          function myChart(data) {
            svg.selectAll("g").remove();
            
            //const tooltip = d3.select("body").append("div").attr("class", "tooltip");
            var tooltip = d3.select("body").append("div").style("position", "absolute").style("z-index", "10")
              .style("visibility", "hidden").style("background", "#000").text("Number of people:");
            const mouseover = function(d) {
              tooltip.style("opacity",1)
              d3.select(this).style("stroke", "#EF4A60").style("opacity", .5)
            };

            const mousemove = function(event,d) {
              tooltip.html(`<b>Number of people</b>: ${d.length}`)
                .style("top", event.pageY - 10 + "px").style("left", event.pageX + 10 + "px")
            };

            const mouseleave = function(d) {
              tooltip.style("opacity", 0)
              d3.select(this).style("stroke", "none").style("opacity",1)
            };
            
            var xScale = d3.scaleLinear().domain([0, d3.max(data, function(d) { return d.Age; })])
              .range([0,width]);
            svg.append("text").attr("transform", "translate(150,50)")
              .attr("xScale",50).attr("yScale",50).attr("font-size", "24px")
              .text("Age Distribution")
            svg.append("g").attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(xScale));
            var histogram = d3.histogram().value(function(d) { return d.Age; })
              .domain(xScale.domain()).thresholds(xScale.ticks(100));
            var bins = histogram(data);
            var yScale = d3.scaleLinear().range([height, 0]);
            yScale.domain([0, d3.max(bins, function(d) { return d.length; })]);
            svg.append("g").call(d3.axisLeft(yScale));
            svg.selectAll("rect").data(bins).join("rect").attr("class", "bar").attr("x",1)
              .attr("transform", d=> `translate(${xScale(d.x0)}, ${yScale(d.length)})`)
                .attr("width",d=>xScale(d.x1) - xScale(d.x0)-1)
                .attr("height",d=>height-yScale(d.length))
                .style("fill","#0072BC")
              .on("mouseover", mouseover)
              .on("mousemove", mousemove)
              .on("mouseleave", mouseleave);

            svg.append("text").attr("class", "chart-label").attr("x", width/2)
              .attr("y", height+margin.bottom/1.7).attr("text-anchor", "middle").text("Age");
            svg.append("text").attr("class", "chart-label").attr("x", -(margin.left)*0.4)
              .attr("y", -(margin.top/5)).attr("text-anchor", "start").text("Number of people");

            //svg.selectAll("g").attr("transform", "translate(50,0)");

            //svg.selectAll("rect").data(bins).enter().append("rect").attr("x",1).attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; }).attr("width", function(d) { return x(d.x1) - x(d.x0) - 1; }).attr("height", function(d) {return height - y(d.length); }).style("fill", "#69b3a2")
                    
          };
        });      
    </script>
  </body>
</html>
