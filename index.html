<!DOCTYPE html>
<html>
  <head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
      .bar {
        fill: steelblue;
      }
    </style>
  </head>
  <body>
    <h1>Investigating Correlations Between Music and Mental Health</h1>
    <p>Sofia Perry, UIUC CS 416 SU23</p>
    <div id="selectMe"></div>
    <div id="chartContainer"></div>
    <div id="viz_container"></div>
    <svg width = "900" height="500"></svg>
    <script>
        var data = d3.csv("scripts/mxmh_survey_results.csv");
        data.then(function (data) {
          myChart();
          const mySelection = document.getElementById("selectMe");
          d3.select(mySelection).append("span").append("p").attr("class","label").text("How should these bars be sorted?").style("front-weight","bold").style("color","red").style("font-size","25px");
          const selectItems = ["Ascending", "Descending"];
          d3.select(mySelection).append("span").append("select").attr("id","selection").attr("name", "tasks").selectAll("option").data(selectItems).enter().append("option").attr("value",d=>d).text(d=>d);
          myChart();
          //document.addEventListener("DOMContentLoaded", myChart());
          d3.select("#selection").on("change", function() {
            const selectedOption = d3.select(this).node().value;
            if (selectedOption == "Ascending") {
              data.sort(function(a,b) { return a.Age - b.Age })
              d3.selectAll("svg > *").remove();
              myChart();
            } else if (selectedOption == "Descending") {
              d3.selectAll("svg > *").remove();
              data.sort(function(b,a) { return a.Age - b.Age })
              myChart();
            }
          });
          
          //data.sort(function(b,a) { return a.Age - b.Age });
          //myChart();
          function myChart() {
          //var svg = d3.select("svg"), margin = 200, width = svg.attr("width") - margin, height = svg.attr("height") - margin
          //svg.append("text").attr("transform", "translate(100,0)").attr("x", 50).attr("y", 50).attr("font-size", "24px").text("Age vs. Depression")
          //var xScale = d3.scaleBand().range([0, width]).padding(0.4), yScale = d3.scaleLinear().range([height, 0]);
          //var g = svg.append("g").attr("transform", "translate(" + 100 + "," + 100 + ")");
          //xScale.domain(data.map(function(d) {return d.Age;}));
          //yScale.domain([0, d3.max(data, function(d) { return d3.count(data, d=>d.Age);})]);

            var svg = d3.select("#viz_container").append("svg"), margin = 200, width = svg.attr("width") - margin, height = svg.attr("height") - margin
            const xScale = d3.scaleLinear().domain([0,100]).range([0,width]);
            svg.append('g').attr("transform",'translate(0, ${height})').call(d3.axisBottom(xScale).tickSize(0).tickPadding(8));
            const yScale = d3.scaleLinear().range([height,0]);
            const xAxis = svg.append('g')
            const GridLine = () => d3.axisLeft().scale(yScale);
            svg.append("g".attr("class", "grid").call(GridLine().tickSize(-width,0,0).tickFormat("").ticks(10));
            const histogram = d3.bin().value(d=>d.Age).domain(xScale.domain()).thresholds(xScale.ticks(20));
            const bins = histogram(data)
            yScale.domain([0,100]);
            yAxis.call(d3.axisLeft(yScale).tickSize(0).tickPadding(4)).call(d=>d.select(".domain").remove());
            svg.selectAll("rect").data(bins).join("rect").attr("class","bar").attr("x",1).attr("transform", d => `translate(${xScale(d.x0)}, ${yScale(d.length)})`).attr("width,d=>'translate(${xScale(d.x1)},${yScale(d.x0)-1).attr("height",d=>height - yScale(d.length));

          
          //g.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(xScale)).append("text").attr("y", height - 250).attr("x", width - 100).attr("text-anchor", "end").attr("stroke", "black").text("Age");
          //g.append("g").call(d3.axisLeft(yScale).tickFormat(function(d){return d;}).ticks(10)).append("text").attr("transform", "rotate(-90)").attr("y", 6).attr("dy", "-5.1em").attr("stroke", "black").text("Depression");
          //g.selectAll(".bar").data(data).enter().append("rect").attr("class", "bar").attr("x", function(d) { return xScale(d.Age);}).attr("y", function(d) { return yScale(d3.count(data, d=>d.Age));}).attr("width", xScale.bandwidth()).attr("height", function(d) { return height - yScale(d3.count(data, d=>d.Age)); });
        
          };
        });
      //d3.csv("scripts/mxmh_survey_results.csv", function(data) {
        //console.log(data);
      //});
    </script>
  </body>
</html>
