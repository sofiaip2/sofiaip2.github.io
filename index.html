<!DOCTYPE html>
<html>
  <head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
      .bar {
        fill: steelblue;
      }
      .tooltip {
        background-color = #fff;
        font-family: lato;
        font-size: 11px;
        padding: 4px;
        color: #666666
        border:none;
        box-shadow: 0px 0px 3px 0px #E6E6E6
      }
    </style>
  </head>
  <body>
    <h1>Investigating Correlations Between Music and Mental Health</h1>
    <p>Sofia Perry, UIUC CS 416 SU23</p>
    <div id="selectMe"></div>
    <div id="area1"></div>
    <div id="area2"></div>
    <svg width = "600" height="500"></svg>
    <script>
        var margin = {top: 100, right: 100, bottom: 100, left: 100}, width = 900-margin.left-margin.right, height=500-margin.top-margin.bottom;
        //var svg = d3.select("#my_dataviz").append("svg").attr("width", width + margin.left + margin.right).attr("height", height+margin.top+margin.bottom).append("g").attr("transform", "translate("+margin.left+","+margin+top+")");            
        var chart1 = d3.select("#area1").append("svg").attr("width", width + margin.left + margin.right).attr("height", height+margin.top+margin.bottom).append("g").attr("transform", "translate("+margin.left+","+margin+top+")");            
        var chart2 = d3.select("#area2").append("svg").attr("width", width + margin.left + margin.right).attr("height", height+margin.top+margin.bottom).append("g").attr("transform", "translate("+margin.left+","+margin+top+")");            

      
        var allData = d3.csv("scripts/mxmh_survey_results.csv");
        allData.then(function (allData) {
          myChart(allData);
          
          const mySelection = document.getElementById("selectMe");
          d3.select(mySelection).append("span").append("p").attr("class","label").text("How should these bars be sorted?").style("front-weight","bold").style("color","red").style("font-size","25px");
          const selectItems = ["All Genres", "Classical", "Country", "EDM", "Folk", "Gospel", "Hip Hop", "Jazz", "K pop", "Latin", "Lofi", "Metal", "Pop", "R&B", "Rap", "Rock", "Video Game Music"];
          d3.select(mySelection).append("span").append("select").attr("id","selection").attr("name", "tasks").selectAll("option").data(selectItems).enter().append("option").attr("value",d=>d).text(d=>d);
          //document.addEventListener("DOMContentLoaded", myChart());
          d3.select("#selection").on("change", function() {
            const selectedOption = d3.select(this).node().value;
            if (selectedOption == "Classical") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyClassical"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Country") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyCountry"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "EDM") {
              var filteredData =allData.filter(function(d) { if(d["FrequencyEDM"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Folk") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyFolk"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Gospel") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyGospel"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Hip Hop") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyHipHop"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Jazz") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyJazz"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "K pop") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyKpop"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Latin") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyLatin"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Lofi") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyLofi"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Metal") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyMetal"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Pop") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyPop"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "R&B") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyR&B"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Rap") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyRap"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Rock") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyRock"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "Video Game Music") {
              var filteredData = allData.filter(function(d) { if(d["FrequencyVideoGameMusic"] == "Very frequently") { return d } })
              myChart(filteredData)
            } else if (selectedOption == "All Genres") {               
              myChart(allData)
            }
          }); 
          
          function myChart(data) {
            createChart(data, chart1, function (d) { d.Age; }, "Age")
            createChart(data, chart2, function (d) { d.Depression; }, "Depression")
          }
          
          function createChart(data, chartNumber, xVar, text) {
                          
            chartNumber.selectAll("g").remove();
            
            const tooltip = d3.select("body").append("div").attr("class", "tooltip").attr("style", "position: absolute; opacity: 1;");
            const mouseover = function(d) {
              tooltip.style("opacity",1)
              d3.select(this).style("stroke", "#EF4A60").style("opacity", .5)
            };

            const mousemove = function(event,d) {
              tooltip.html(`<b>Number of people</b>: ${d.length}`)
                .style("top", event.pageY - 10 + "px").style("left", event.pageX + 10 + "px")
            };

            const mouseleave = function(d) {
              tooltip.style("opacity", 0)
              d3.select(this).style("stroke", "none").style("opacity",1)
            };
                        
            var xScale = d3.scaleLinear().domain([0, d3.max(data, xVar)])
              .range([0,width]);
            chartNumber.append("text").attr("transform", "translate(150,50)")
              .attr("xScale",50).attr("yScale",50).attr("font-size", "24px")
              .text( text + " Distribution")
            
            
            chartNumber.append("g").attr("transform", "translate(0," + height + ")")  
              .call(d3.axisBottom(xScale));
            
            var histogram = d3.histogram().value(xVar)
              .domain(xScale.domain()).thresholds(xScale.ticks(100));
            
            var bins = histogram(data);
            
            var yScale = d3.scaleLinear().range([height, 0]);
            
            yScale.domain([0, d3.max(bins, function(d) { return d.length; })]);
            
            chartNumber.append("g").call(d3.axisLeft(yScale));
            
            chartNumber.selectAll("rect").data(bins).join("rect").attr("class", "bar").attr("x",1)
              .attr("transform", d=> `translate(${xScale(d.x0)}, ${yScale(d.length)})`)
                .attr("width",d=>xScale(d.x1) - xScale(d.x0)-1)
                .attr("height",d=>height-yScale(d.length))
                .style("fill","#0072BC")
              .on("mouseover", mouseover)
              .on("mousemove", mousemove)
              .on("mouseleave", mouseleave);

            chartNumber.append("text").attr("class", "chart-label").attr("x", width/2)
              .attr("y", height+margin.bottom/1.7).attr("text-anchor", "middle").text(text);
            chartNumber.append("text").attr("class", "chart-label").attr("x", -(margin.left)*0.4)
              .attr("y", -(margin.top/5)).attr("text-anchor", "start").text("Number of people");
          };
        });      
    </script>
  </body>
</html>
